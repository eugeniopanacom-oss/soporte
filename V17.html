<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.S. Studio - Barber√≠a Profesional</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        /* Variables de tema oscuro */
        :root {
            --primary: #d4af37;
            --primary-dark: #b8941f;
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f5f5f5;
            --gray: #2a2a2a;
            --gray-light: #3a3a3a;
            --success: #4caf50;
            --error: #f44336;
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        /* Reset y estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 100px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header y navegaci√≥n */
        header {
            background-color: var(--darker);
            padding: 20px 0;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo i {
            color: var(--primary);
            font-size: 2.5rem;
        }

        .logo h1 {
            font-size: 2.5rem;
            color: var(--primary);
            letter-spacing: 2px;
        }

        .tagline {
            text-align: center;
            color: #aaa;
            font-style: italic;
            margin-top: 5px;
        }

        /* Navegaci√≥n entre p√°ginas */
        .page-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .page-btn {
            background-color: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 10px 25px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .page-btn:hover,
        .page-btn.active {
            background-color: var(--primary);
            color: var(--dark);
        }

        /* Secciones generales */
        section {
            padding: 40px 0;
            border-bottom: 1px solid var(--gray);
        }

        .section-title {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-align: center;
            position: relative;
        }

        .section-title:after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background-color: var(--primary);
            margin: 10px auto;
        }

        /* Bienvenida */
        .welcome {
            text-align: center;
            padding: 60px 0;
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url('https://images.unsplash.com/photo-1585747860715-2ba37e788b70?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1174&q=80') center/cover no-repeat;
            border-radius: var(--border-radius);
            margin: 30px 0;
        }

        .welcome h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .welcome p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            color: #ddd;
        }

        .btn {
            display: inline-block;
            background-color: var(--primary);
            color: var(--dark);
            padding: 12px 30px;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
        }

        .btn:disabled {
            background-color: var(--gray-light);
            cursor: not-allowed;
            transform: none;
        }

        /* Informaci√≥n de contacto */
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background-color: var(--gray);
            padding: 25px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary);
        }

        .info-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .contact-link {
            color: var(--light);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .contact-link:hover {
            color: var(--primary);
        }

        .contact-link.whatsapp:hover {
            color: #25D366;
        }

        .contact-link.instagram:hover {
            color: #E4405F;
        }

        .barbero-description {
            background-color: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            border-left: 3px solid var(--primary);
        }

        /* Calendario y horarios */
        .calendar-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: space-between;
        }

        .calendar-container {
            flex: 1;
            min-width: 300px;
        }

        .hours-container {
            flex: 1;
            min-width: 300px;
            background-color: var(--gray);
            padding: 25px;
            border-radius: var(--border-radius);
        }

        .calendar {
            background-color: var(--gray);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--primary);
            color: var(--dark);
            padding: 15px;
            font-weight: bold;
        }

        .calendar-days,
        .calendar-dates {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: var(--gray-light);
        }

        .calendar-day {
            padding: 15px;
            text-align: center;
            background-color: var(--gray);
            font-weight: bold;
        }

        .calendar-date {
            padding: 15px;
            text-align: center;
            background-color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-date:hover {
            background-color: var(--gray-light);
        }

        .calendar-date.selected {
            background-color: var(--primary);
            color: var(--dark);
            font-weight: bold;
        }

        .calendar-date.disabled {
            background-color: var(--darker);
            color: #666;
            cursor: not-allowed;
        }

        .hours-list {
            margin-top: 20px;
        }

        .hour-option {
            display: inline-block;
            padding: 10px 15px;
            background-color: var(--dark);
            margin: 5px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--gray-light);
        }

        .hour-option:hover {
            border-color: var(--primary);
        }

        .hour-option.selected {
            background-color: var(--primary);
            color: var(--dark);
            font-weight: bold;
        }

        .hour-option.disabled {
            background-color: var(--darker);
            color: #666;
            cursor: not-allowed;
            border-color: var(--darker);
        }

        /* Servicios y precios (m√°s peque√±o) */
        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .service-card {
            background-color: var(--gray);
            padding: 20px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .service-card:hover {
            border-color: var(--primary);
        }

        .service-name {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .service-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--light);
        }

        /* Formulario de reserva */
        .reservation-form {
            background-color: var(--gray);
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--dark);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            color: var(--light);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
            min-width: 250px;
        }

        .reservation-summary {
            background-color: var(--dark);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }

        /* Modal de confirmaci√≥n */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background-color: var(--gray);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .modal-info {
            margin-bottom: 15px;
        }

        .modal-info strong {
            color: var(--primary);
            display: inline-block;
            width: 120px;
        }

        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-decoration: none;
            display: block;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            transition: var(--transition);
        }

        .whatsapp-btn:hover {
            background-color: #1da851;
        }

        .copy-btn {
            background-color: var(--dark);
            color: var(--light);
            border: 1px solid var(--gray-light);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
            justify-content: center;
        }

        .copy-btn:hover {
            border-color: var(--primary);
        }

        .close-btn {
            background-color: transparent;
            color: var(--light);
            border: 1px solid var(--gray-light);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: var(--transition);
        }

        .close-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Reportar problemas */
        .report-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--darker);
            padding: 15px;
            border-top: 1px solid var(--gray);
            z-index: 1000;
        }

        .report-toggle {
            background-color: var(--primary);
            color: var(--dark);
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .report-form {
            max-width: 500px;
            margin: 20px auto 0;
            background-color: var(--gray);
            padding: 20px;
            border-radius: var(--border-radius);
            display: none;
        }

        .report-form.active {
            display: block;
        }

        .capture-btn {
            background-color: var(--dark);
            color: var(--light);
            border: 1px solid var(--gray-light);
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        /* Notificaciones */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: bold;
            z-index: 10000;
            display: none;
            animation: slideIn 0.5s ease;
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--error);
        }

        .notification.info {
            background-color: var(--primary);
            color: var(--dark);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Control de visibilidad de p√°ginas */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Cargando */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo h1 {
                font-size: 2rem;
            }

            .welcome h2 {
                font-size: 1.8rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .calendar-section {
                flex-direction: column;
            }

            .info-cards {
                grid-template-columns: 1fr;
            }
        }

        /* ========== VENTANA DE CONFIRMACI√ìN NUEVA ========== */
        .confirmation-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999999;
            padding: 20px;
            animation: fadeIn 0.4s ease;
        }

        .confirmation-modal-overlay.active {
            display: flex !important;
        }

        .confirmation-window {
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            border: 3px solid transparent;
            box-shadow:
                0 0 50px rgba(212, 175, 55, 0.4),
                0 0 100px rgba(212, 175, 55, 0.2),
                inset 0 0 30px rgba(212, 175, 55, 0.1);
            animation: slideUp 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        /* Efecto borde dorado brillante */
        .confirmation-window::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg,
                    #d4af37,
                    #b8941f,
                    #ffd700,
                    #d4af37);
            border-radius: 23px;
            z-index: -1;
            opacity: 0.7;
            animation: borderGlow 3s infinite linear;
        }

        @keyframes borderGlow {
            0% {
                background-position: 0% 50%;
                opacity: 0.7;
            }

            50% {
                background-position: 100% 50%;
                opacity: 1;
            }

            100% {
                background-position: 0% 50%;
                opacity: 0.7;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px) scale(0.95);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* T√≠tulo con efecto ne√≥n */
        .confirmation-title {
            color: #d4af37;
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 30px;
            text-shadow:
                0 0 15px rgba(212, 175, 55, 0.5),
                0 0 25px rgba(212, 175, 55, 0.3),
                0 0 35px rgba(212, 175, 55, 0.1);
            letter-spacing: 1.5px;
            font-weight: 700;
            animation: titleGlow 2s infinite alternate;
        }

        @keyframes titleGlow {
            from {
                text-shadow:
                    0 0 15px rgba(212, 175, 55, 0.5),
                    0 0 25px rgba(212, 175, 55, 0.3);
            }

            to {
                text-shadow:
                    0 0 20px rgba(212, 175, 55, 0.7),
                    0 0 30px rgba(212, 175, 55, 0.4),
                    0 0 40px rgba(212, 175, 55, 0.2);
            }
        }

        /* Lista de informaci√≥n */
        .confirmation-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #d4af37;
            backdrop-filter: blur(10px);
        }

        .confirmation-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .confirmation-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .confirmation-label {
            color: #d4af37;
            font-weight: 600;
            min-width: 130px;
            font-size: 1.1rem;
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
        }

        .confirmation-value {
            color: white;
            font-size: 1.2rem;
            flex: 1;
            font-weight: 500;
        }

        .confirmation-value.total {
            color: #d4af37 !important;
            font-weight: bold;
            font-size: 1.4rem;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
        }

        /* Botones */
        .confirmation-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .confirmation-btn {
            flex: 1;
            padding: 16px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: none;
            outline: none;
        }

        .whatsapp-confirm {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            box-shadow: 0 5px 20px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-confirm:hover {
            background: linear-gradient(135deg, #1da851, #0d796e);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
        }

        .close-confirm {
            background: rgba(212, 175, 55, 0.15);
            color: white;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .close-confirm:hover {
            background: rgba(212, 175, 55, 0.25);
            border-color: #d4af37;
            transform: translateY(-3px);
        }

        /* Nota */
        .confirmation-note {
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-style: italic;
        }

        /* A√±ade esto al final de tu secci√≥n CSS */

        /* Efectos de ne√≥n mejorados para botones */
        .whatsapp-confirm {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            box-shadow:
                0 0 15px rgba(37, 211, 102, 0.5),
                0 0 30px rgba(37, 211, 102, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.2);
            border: 2px solid #25D366;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .whatsapp-confirm::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg,
                    #25D366, #128C7E, #25D366);
            z-index: -1;
            border-radius: 10px;
            opacity: 0.8;
            animation: whatsappGlow 2s infinite alternate;
        }

        @keyframes whatsappGlow {
            0% {
                box-shadow: 0 0 10px rgba(37, 211, 102, 0.5);
                opacity: 0.7;
            }

            100% {
                box-shadow: 0 0 20px rgba(37, 211, 102, 0.8);
                opacity: 1;
            }
        }

        .close-confirm {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            box-shadow:
                0 0 15px rgba(255, 68, 68, 0.5),
                0 0 30px rgba(255, 68, 68, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.2);
            border: 2px solid #ff4444;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .close-confirm::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg,
                    #ff4444, #cc0000, #ff4444);
            z-index: -1;
            border-radius: 10px;
            opacity: 0.8;
            animation: closeGlow 2s infinite alternate;
        }

        @keyframes closeGlow {
            0% {
                box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
                opacity: 0.7;
            }

            100% {
                box-shadow: 0 0 20px rgba(255, 68, 68, 0.8);
                opacity: 1;
            }
        }

        /* Efectos hover mejorados */
        .whatsapp-confirm:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                0 0 20px rgba(37, 211, 102, 0.7),
                0 0 40px rgba(37, 211, 102, 0.5),
                inset 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .close-confirm:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                0 0 20px rgba(255, 68, 68, 0.7),
                0 0 40px rgba(255, 68, 68, 0.5),
                inset 0 0 15px rgba(255, 255, 255, 0.3);
        }

        /* Mejorar bordes dorados del modal */
        .confirmation-window::before {
            animation: borderGlow 3s infinite linear;
            background: linear-gradient(45deg,
                    #d4af37, #ffd700, #b8941f, #ffd700, #d4af37);
            background-size: 200% 200%;
        }

        @keyframes borderGlow {
            0% {
                background-position: 0% 50%;
                opacity: 0.8;
            }

            50% {
                background-position: 100% 50%;
                opacity: 1;
            }

            100% {
                background-position: 0% 50%;
                opacity: 0.8;
            }
        }

        /* Animaciones */

        @keyframes slideUp {
            from {
                transform: translateY(30px) scale(0.95);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }

            /* Agrega al final de tu CSS */
            form-controlvalid {
                border-color: var(--success) !important;
                box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2) !important;
            }

            form-control-invalid {
                border-color: var(--error) !important;
                box-shadow: 0 0 0 2px rgba(244, 67, 54, 0.2) !important;
            }
        }
    </style>
</head>

<body>
    <!-- Header con logo -->
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-cut"></i>
                <h1>A.S. Studio</h1>
            </div>
            <p class="tagline">Barber√≠a profesional - Un √∫nico barbero, m√°xima atenci√≥n</p>

            <!-- Navegaci√≥n entre p√°ginas -->
            <div class="page-nav">
                <button class="page-btn active" id="btnMainPage">
                    <i class="fas fa-home"></i> P√°gina Principal
                </button>
                <button class="page-btn" id="btnReservationPage">
                    <i class="fas fa-calendar-alt"></i> Reservar Turno
                </button>
            </div>
        </div>
    </header>

    <!-- P√°gina Principal -->
    <main class="container">
        <div id="mainPage" class="page active">
            <!-- Secci√≥n de bienvenida -->
            <section class="welcome">
                <h2>Bienvenido a A.S. Studio</h2>
                <p>Experimenta el arte de la barber√≠a tradicional con un toque moderno. Reserva tu turno para recibir un
                    servicio personalizado de la m√°s alta calidad.</p>
                <button class="btn" id="goToReservationBtn">
                    <i class="fas fa-calendar-alt"></i> Reservar Turno
                </button>
            </section>

            <!-- Servicios y precios (m√°s peque√±o) -->
            <section id="services">
                <h2 class="section-title">Servicios y Precios</h2>
                <div class="services">
                    <div class="service-card">
                        <h3 class="service-name">Corte de Cabello</h3>
                        <p>Corte tradicional o moderno seg√∫n tu preferencia.</p>
                        <p class="service-price">$2.500</p>
                    </div>
                    <div class="service-card">
                        <h3 class="service-name">Corte + Barba</h3>
                        <p>Corte de cabello m√°s arreglo de barba.</p>
                        <p class="service-price">$3.200</p>
                    </div>
                    <div class="service-card">
                        <h3 class="service-name">Arreglo de Barba</h3>
                        <p>Modelado, recorte y acabado de barba.</p>
                        <p class="service-price">$1.800</p>
                    </div>
                    <div class="service-card">
                        <h3 class="service-name">Afeitado Cl√°sico</h3>
                        <p>Afeitado tradicional con navaja y toallas calientes.</p>
                        <p class="service-price">$2.200</p>
                    </div>
                </div>
            </section>

            <!-- Informaci√≥n de contacto -->
            <section id="info">
                <h2 class="section-title">Informaci√≥n de Contacto</h2>
                <div class="info-cards">
                    <div class="info-card">
                        <h3><i class="fas fa-map-marker-alt"></i> Direcci√≥n</h3>
                        <a href="https://www.google.com/maps/place/Int.+Alberto+Barzi+3231,+B1888+Florencio+Varela,+Provincia+de+Buenos+Aires/@-34.8124414,-58.2905572,79m/data=!3m1!1e3!4m6!3m5!1s0x95a32bdce01931d1:0x8f3c221ed55a3b39!8m2!3d-34.8124374!4d-58.2903754!16s%2Fg%2F11k64ymf22?entry=ttu&g_ep=EgoyMDI2MDEyOC4wIKXMDSoASAFQAw%3D%3D"
                            target="_blank" class="contact-link">
                            <i class="fas fa-external-link-alt"></i> Int. Alberto Barzi 3231, Florencio Varela
                            Ciudad
                        </a>
                        <p>Haz clic para ver en Google Maps</p>
                    </div>
                    <div class="info-card">
                        <h3><i class="fas fa-clock"></i> Horario de Atenci√≥n</h3>
                        <p>Lunes a Viernes: 9:00 - 19:00<br>S√°bados: 10:00 - 16:00<br>Domingos: Cerrado</p>
                        <button class="btn" id="goToCalendarBtn" style="margin-top: 15px; width: 100%;">
                            <i class="fas fa-calendar-day"></i> Ver Calendario
                        </button>
                    </div>
                    <div class="info-card">
                        <h3><i class="fas fa-phone-alt"></i> Contacto</h3>
                        <a href="https://wa.me/54911155739203" target="_blank" class="contact-link whatsapp">
                            <i class="fab fa-whatsapp"></i> +54 9 11 5573-9203
                        </a>
                        <a href="https://www.instagram.com/alexis.sebastiann?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="
                            target="_blank" class="contact-link instagram">
                            <i class="fab fa-instagram"></i> @alexis.sebastiann
                        </a>
                        <div class="barbero-description">
                            <p><strong>Alexis</strong>, tu barbero profesional.</p>
                            <p>"Cada corte es una obra de arte. Espero tu visita para crear el estilo perfecto para ti."
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- P√°gina de Reserva -->
        <div id="reservationPage" class="page">
            <!-- Calendario y horarios -->
            <section id="schedule">
                <h2 class="section-title">Selecciona Fecha y Hora</h2>
                <div class="calendar-section">
                    <div class="calendar-container">
                        <div class="calendar">
                            <div class="calendar-header">
                                <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                                <h3 id="currentMonth">Enero 2026</h3>
                                <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-days">
                                <div class="calendar-day">Dom</div>
                                <div class="calendar-day">Lun</div>
                                <div class="calendar-day">Mar</div>
                                <div class="calendar-day">Mi√©</div>
                                <div class="calendar-day">Jue</div>
                                <div class="calendar-day">Vie</div>
                                <div class="calendar-day">S√°b</div>
                            </div>
                            <div class="calendar-dates" id="calendarDates">
                                <!-- Los d√≠as se generar√°n con JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="hours-container">
                        <h3>Horarios disponibles</h3>
                        <p id="selectedDateText">Selecciona una fecha en el calendario</p>
                        <div class="hours-list" id="hoursList">
                            <!-- Los horarios se generar√°n con JavaScript -->
                        </div>
                        <div class="info-card" style="margin-top: 20px;">
                            <h3><i class="fas fa-info-circle"></i> Importante</h3>
                            <p>No se pueden reservar dos turnos en el mismo d√≠a y horario. Cada cita tiene una duraci√≥n
                                aproximada de 30-45 minutos.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Formulario de reserva -->
            <section id="reservation">
                <h2 class="section-title">Reserva tu Turno</h2>
                <div class="reservation-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientName">Nombre / Apodo *</label>
                            <input type="text" id="clientName" class="form-control"
                                placeholder="Ej: Juan o 'El Guille'">
                        </div>
                        <div class="form-group">
                            <label for="clientWhatsApp">N√∫mero de WhatsApp *</label>
                            <input type="tel" id="clientWhatsApp" class="form-control"
                                placeholder="Ej: 1120502186 (10 d√≠gitos)" maxlength="10">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="serviceSelect">Servicio *</label>
                        <select id="serviceSelect" class="form-control">
                            <option value="">Selecciona un servicio</option>
                            <option value="Corte de Cabello">Corte de Cabello - $2.500</option>
                            <option value="Corte + Barba">Corte + Barba - $3.200</option>
                            <option value="Arreglo de Barba">Arreglo de Barba - $1.800</option>
                            <option value="Afeitado Cl√°sico">Afeitado Cl√°sico - $2.200</option>
                        </select>
                    </div>

                    <div class="reservation-summary">
                        <h3>Resumen de tu Reserva</h3>
                        <p><strong>Fecha:</strong> <span id="summaryDate">No seleccionada</span></p>
                        <p><strong>Hora:</strong> <span id="summaryTime">No seleccionada</span></p>
                        <p><strong>Servicio:</strong> <span id="summaryService">No seleccionado</span></p>
                        <p><strong>Total:</strong> <span id="summaryPrice">$0</span></p>
                    </div>

                    <div class="form-group">
                        <p style="color: #aaa; font-size: 0.9rem; margin-top: 20px;">
                            * Al confirmar la reserva, deber√°s enviar un mensaje al barbero por WhatsApp para confirmar
                            tu turno.
                        </p>
                    </div>

                    <button type="button" class="btn" id="confirmReservationBtn"
                        style="width: 100%; padding: 15px; font-size: 1.1rem;">
                        <i class="fas fa-check-circle"></i> <span id="confirmText">Confirmar Reserva</span>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- NUEVO MODAL DE CONFIRMACI√ìN - REEMPLAZA COMPLETAMENTE -->
    <div class="confirmation-modal-overlay" id="newConfirmationModal">
        <div class="confirmation-window">
            <h2 class="confirmation-title">¬°RESERVA CONFIRMADA!</h2>

            <div class="confirmation-info">
                <div class="confirmation-item">
                    <span class="confirmation-label">Cliente:</span>
                    <span class="confirmation-value" id="newModalClientName">-</span>
                </div>
                <div class="confirmation-item">
                    <span class="confirmation-label">Contacto:</span>
                    <span class="confirmation-value" id="newModalWhatsApp">-</span>
                </div>
                <div class="confirmation-item">
                    <span class="confirmation-label">Fecha:</span>
                    <span class="confirmation-value" id="newModalDate">-</span>
                </div>
                <div class="confirmation-item">
                    <span class="confirmation-label">Hora:</span>
                    <span class="confirmation-value" id="newModalTime">-</span>
                </div>
                <div class="confirmation-item">
                    <span class="confirmation-label">Servicio:</span>
                    <span class="confirmation-value" id="newModalService">-</span>
                </div>
                <div class="confirmation-item">
                    <span class="confirmation-label">Total:</span>
                    <span class="confirmation-value total" id="newModalPrice">$0</span>
                </div>
            </div>

            <div class="confirmation-note">
                El barbero se contactar√° para confirmar la disponibilidad.
            </div>

            <div class="confirmation-actions">
                <button class="confirmation-btn whatsapp-confirm" id="newWhatsappConfirmBtn">
                    <i class="fab fa-whatsapp"></i> Confirmar por WhatsApp
                </button>
                <button class="confirmation-btn close-confirm" id="newCloseModalBtn">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Secci√≥n para reportar problemas -->
    <footer class="report-section">
        <button class="report-toggle" id="toggleReport">
            <i class="fas fa-exclamation-triangle"></i> Reportar un Problema
        </button>

        <div class="report-form" id="reportForm">
            <div class="form-group">
                <label for="problemDescription">Describe el problema *</label>
                <textarea id="problemDescription" class="form-control" rows="3"
                    placeholder="Detalla el problema que encontraste..."></textarea>
            </div>

            <button class="capture-btn" id="captureScreen">
                <i class="fas fa-camera"></i> Capturar Pantalla
            </button>

            <button class="btn" id="sendReport" style="margin-top: 15px; width: 100%;">
                <i class="fas fa-paper-plane"></i> Enviar Reporte
            </button>
        </div>
    </footer>

    <!-- Notificaci√≥n -->
    <div class="notification" id="notification"></div>

    <script>

        // ========== VARIABLES GLOBALES ==========
        let db = null;
        let selectedDate = null;
        let selectedTime = null;
        let selectedService = null;
        let isSaving = false;
        let currentMonth, currentYear;
        let bookedSlots = {};
        let reservaEnProgreso = false; // Para evitar m√∫ltiples clics
        window.reservaEnProgreso = false;
        let blockedHours = {};

        // Inicializar blockedHours como objeto vac√≠o
        window.blockedHours = window.blockedHours || {};

        // ========== CONTROL DE EJECUCI√ìN ==========
        let firebaseInitialized = false;
        let eventListenersSet = false;
        let loadingData = false;

        // Funci√≥n para inicializar TODO UNA SOLA VEZ
        async function initializeApp() {
            console.log("üöÄ Iniciando aplicaci√≥n...");

            // 1. Inicializar Firebase solo si no se ha hecho
            if (!firebaseInitialized) {
                await initializeFirebase();
                firebaseInitialized = true;
                console.log("‚úÖ Firebase inicializado una sola vez");
            }

            // 2. Configurar eventos solo si no se ha hecho
            if (!eventListenersSet) {
                setupEventListeners();
                eventListenersSet = true;
                console.log("‚úÖ Event listeners configurados una sola vez");
            }

            // 3. Inicializar calendario
            initCalendar();
        }

        // ========== CONFIGURACI√ìN FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyB3xCos-qTAOs8VIgcZk3ntUnPeI13YqR8",
            authDomain: "as-studio-d02c4.firebaseapp.com",
            projectId: "as-studio-d02c4",
            storageBucket: "as-studio-d02c4.firebasestorage.app",
            messagingSenderId: "1021827477452",
            appId: "1:1021827477452:web:4bd7fa03063720f1cdb769",
        };

        // Inicializar Firebase
        try {
            // Inicializar Firebase
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("‚úÖ Firebase inicializado correctamente");
        } catch (error) {
            console.error("‚ùå Error inicializando Firebase:", error);
            // Modo demo si falla
        }

        async function loadServiciosFromFirebase() {
            if (!db) {
                loadDefaultServices();
                return;
            }

            try {
                const snapshot = await db.collection('servicios')
                    .orderBy('precio', 'asc')
                    .get();

                if (!snapshot.empty) {
                    window.servicePrices = {};
                    const services = [];

                    snapshot.forEach(doc => {
                        const servicio = doc.data();
                        services.push(servicio);
                        window.servicePrices[servicio.nombre] = servicio.precio;
                    });

                    // Actualizar selector
                    const serviceSelect = document.getElementById('serviceSelect');
                    if (serviceSelect && services.length > 0) {
                        serviceSelect.innerHTML = '<option value="">Selecciona un servicio</option>';
                        services.forEach(servicio => {
                            const option = document.createElement('option');
                            option.value = servicio.nombre;
                            option.textContent = `${servicio.nombre} - $${servicio.precio.toLocaleString('es-AR')}`;
                            serviceSelect.appendChild(option);
                        });
                    }

                    // Actualizar cards
                    const servicesSection = document.querySelector('.services');
                    if (servicesSection && services.length > 0) {
                        servicesSection.innerHTML = '';
                        services.forEach(servicio => {
                            const serviceCard = document.createElement('div');
                            serviceCard.className = 'service-card';
                            serviceCard.innerHTML = `
                        <h3 class="service-name">${servicio.nombre}</h3>
                        <p>${servicio.descripcion || 'Servicio profesional'}</p>
                        <p class="service-price">$${servicio.precio.toLocaleString('es-AR')}</p>
                    `;
                            servicesSection.appendChild(serviceCard);
                        });
                    }
                }
            } catch (error) {
                console.error('Error cargando servicios:', error);
                loadDefaultServices();
            }
        }

        async function loadBookedSlotsFromFirebase() {
            if (!db) {
                loadDemoData();
                return;
            }

            try {
                // CARGAR TURNOS RESERVADOS
                const turnosSnapshot = await db.collection('turnos')
                    .where('estado', 'in', ['pendiente', 'confirmado', 'asistio'])
                    .get();

                window.bookedSlots = {};
                window.blockedHours = window.blockedHours || {}; // Inicializar si no existe

                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);

                // Procesar turnos reservados
                turnosSnapshot.forEach(doc => {
                    const turno = doc.data();

                    if (turno.fecha && turno.hora && turno.estado) {
                        const fechaTurno = parseDate(turno.fecha);

                        // Solo fechas futuras
                        if (fechaTurno < hoy) return;

                        if (!window.bookedSlots[turno.fecha]) {
                            window.bookedSlots[turno.fecha] = [];
                        }
                        if (!window.bookedSlots[turno.fecha].includes(turno.hora)) {
                            window.bookedSlots[turno.fecha].push(turno.hora);
                        }
                    }
                });

                console.log('Turnos cargados:', Object.keys(window.bookedSlots).length, 'fechas');

                // üî¥ INTENTAR CARGAR HORARIOS BLOQUEADOS (con try-catch por si hay error de permisos)
                try {
                    const configSnapshot = await db.collection('configuracion')
                        .doc('horariosBloqueados')
                        .get();

                    if (configSnapshot.exists) {
                        const config = configSnapshot.data();
                        window.blockedHours = config.horariosBloqueados || {};
                        console.log('‚úÖ Horarios bloqueados cargados:', window.blockedHours);
                    } else {
                        console.log('‚ö†Ô∏è No hay horarios bloqueados configurados');
                        window.blockedHours = {};
                    }
                } catch (configError) {
                    console.log('‚ö†Ô∏è No se pudieron cargar horarios bloqueados (posible error de permisos):', configError.message);
                    window.blockedHours = {}; // Inicializar vac√≠o
                }

            } catch (error) {
                console.error('‚ùå Error cargando datos:', error);
                loadDemoData();
            }
        }

        async function initializeFirebase() {
            console.log("üöÄ INICIALIZANDO FIREBASE");

            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log("‚úÖ Firebase inicializado correctamente");

                await loadServiciosFromFirebase();
                await loadBookedSlotsFromFirebase();

                // INICIAR ESCUCHA EN TIEMPO REAL
                setupFirebaseRealtimeListeners();

                console.log("‚úÖ Firebase conectado y listeners activados");
            } catch (error) {
                console.log("‚ö†Ô∏è Firebase en modo demo:", error.message);
                loadDemoData();
                showNotification('Modo demostraci√≥n activado', 'info');
            }
            // Escuchar cambios en sincronizaci√≥n
            db.collection('configuracion').doc('ultima_sincronizacion')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        console.log('üîÑ Cambios detectados en configuraci√≥n de agenda');
                        showNotification('Agenda actualizada', 'info');

                        // Recargar configuraci√≥n si hay una fecha seleccionada
                        if (window.selectedDate) {
                            updateAvailableHours();
                        }
                    }
                });
        }

        function debugTurnosReservados() {
            console.log("üîç DEBUG de turnos reservados:");
            console.log("Fecha seleccionada:", window.selectedDate);
            console.log("Turnos para esta fecha:", window.bookedSlots[window.selectedDate]);
            console.log("Todos los bookedSlots:", JSON.stringify(window.bookedSlots));

            // Verificar si 17:30 est√° en el array
            if (window.bookedSlots[window.selectedDate]) {
                console.log("¬øEst√° 17:30 reservado?", window.bookedSlots[window.selectedDate].includes("17:30"));
            }
        }

        // Escuchar cambios en tiempo real en Firebase
        function setupFirebaseRealtimeListeners() {
            if (!db) return;

            // Escuchar cambios en turnos
            db.collection('turnos')
                .where('estado', 'in', ['pendiente', 'confirmado', 'asistio', 'cancelado'])
                .onSnapshot((snapshot) => {
                    console.log('üîÑ Cambios detectados en turnos');
                    loadBookedSlotsFromFirebase().then(() => {
                        if (window.selectedDate) {
                            updateAvailableHours();
                        }
                    });
                });

            // Escuchar cambios en configuraci√≥n de horarios bloqueados
            db.collection('configuracion')
                .doc('horariosBloqueados')
                .onSnapshot((doc) => {
                    console.log('üîÑ Cambios detectados en horarios bloqueados');
                    if (doc.exists) {
                        window.blockedHours = doc.data().horariosBloqueados || {};
                        if (window.selectedDate) {
                            updateAvailableHours();
                        }
                    }
                });
        }

        async function saveReservationToFirebase(clientName, clientWhatsApp) {
            if (!db) {
                // VERIFICAR SI EL HORARIO EST√Å BLOQUEADO POR ADMIN
                const blockedForDate = window.blockedHours[window.selectedDate] || [];
                if (blockedForDate.includes(window.selectedTime)) {
                    console.log('‚ùå Horario bloqueado por administrador');
                    return {
                        success: false,
                        message: 'Este horario no est√° disponible'
                    };
                }

                // Validar que sea hora en punto (00 minutos)
                const minutos = window.selectedTime.split(':')[1];
                if (minutos !== '00') {
                    return {
                        success: false,
                        message: 'Solo se permiten reservas en horas en punto (ej: 11:00, 14:00)'
                    };
                }

                // VERIFICAR SI EL D√çA EST√Å COMPLETAMENTE BLOQUEADO
                if (window.blockedHours[window.selectedDate] === 'all') {
                    console.log('‚ùå D√≠a bloqueado por administrador');
                    return {
                        success: false,
                        message: 'Este d√≠a no est√° disponible'
                    };
                }

                // Modo demo
                await new Promise(resolve => setTimeout(resolve, 800));
                return {
                    success: true,
                    data: {
                        id: 'demo-' + Date.now(),
                        fecha: window.selectedDate,
                        hora: window.selectedTime,
                        servicio: window.selectedService
                    }
                };
            }

            try {
                const precio = window.servicePrices[window.selectedService] || 0;

                const reservationData = {
                    fecha: window.selectedDate,
                    hora: window.selectedTime,
                    servicio: window.selectedService,
                    nombre: clientName,
                    telefono: clientWhatsApp,
                    precio: precio,
                    estado: 'pendiente',
                    created_at: firebase.firestore.FieldValue.serverTimestamp()
                };

                // VERIFICACI√ìN CR√çTICA: ¬øYa existe esta reserva?
                const existingQuery = await db.collection('turnos')
                    .where('fecha', '==', window.selectedDate)
                    .where('hora', '==', window.selectedTime)
                    .where('estado', 'in', ['pendiente', 'confirmado'])
                    .limit(1)
                    .get();

                if (!existingQuery.empty) {
                    console.log('‚ùå Ya existe una reserva para esta fecha y hora');
                    return {
                        success: false,
                        message: 'Este horario ya est√° reservado'
                    };
                }

                // Guardar solo si no existe
                const docRef = await db.collection('turnos').add(reservationData);
                console.log('‚úÖ Reserva guardada en Firebase con ID:', docRef.id);

                // Agregar al array local INMEDIATAMENTE
                if (!window.bookedSlots[window.selectedDate]) {
                    window.bookedSlots[window.selectedDate] = [];
                }
                window.bookedSlots[window.selectedDate].push(window.selectedTime);

                return {
                    success: true,
                    data: { id: docRef.id, ...reservationData }
                };

            } catch (error) {
                console.error('üí• Error guardando en Firebase:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }

        // Funci√≥n para debuguear eventos
        function debugEventListeners() {
            console.log("üîç DEBUG: Contando event listeners...");

            const confirmBtn = document.getElementById('confirmReservationBtn');
            if (confirmBtn) {
                console.log(`Bot√≥n confirmar tiene ${confirmBtn._clickListeners || 0} listeners`);
            }

            console.log("üìä Variables globales:", {
                selectedDate: window.selectedDate,
                selectedTime: window.selectedTime,
                selectedService: window.selectedService,
                bookedSlotsCount: Object.keys(window.bookedSlots || {}).length
            });
        }

        // Al inicio del script, agregar compatibilidad
        if (!document.execCommand && navigator.clipboard) {
            document.execCommand = function (command, showUI, value) {
                if (command === 'copy' && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(value).then(() => true);
                    return true;
                }
                return false;
            };
        }

        // 2. Precios de servicios
        window.servicePrices = {
            'Corte de Cabello': 2500,
            'Corte + Barba': 3200,
            'Arreglo de Barba': 1800,
            'Afeitado Cl√°sico': 2200
        };

        // 3. Define TODAS las funciones primero
        async function confirmReservation() { /* c√≥digo */ }
        function showNotification() { /* c√≥digo */ }
        // ... todas las dem√°s funciones ...

        // 4. FINALMENTE, el c√≥digo que ejecuta al cargar
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('DOM cargado');
            await initializeFirebase();  // ‚Üê Nueva funci√≥n
            initCalendar();
            setupEventListeners(); // Ahora S√ç est√° definida
        });



        // ========== FUNCIONES FALTANTES ==========
        function checkIfDateFullyBooked(dateStr) {
            if (!window.bookedSlots[dateStr]) return false;

            const allHours = [];
            for (let hour = 9; hour <= 18; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    if (hour === 18 && minute > 0) break;
                    const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    allHours.push(timeStr);
                }
            }

            const bookedHours = window.bookedSlots[dateStr] || [];
            return allHours.every(hour => bookedHours.includes(hour));
        }

        function loadDefaultServices() {
            console.log('üì¶ Cargando servicios por defecto');
            window.servicePrices = {
                'Corte de Cabello': 2500,
                'Corte + Barba': 3200,
                'Arreglo de Barba': 1800,
                'Afeitado Cl√°sico': 2200
            };
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function loadDemoData() {
            console.log('Cargando datos demo');
            window.bookedSlots = {};
            const hoy = new Date();

            for (let i = 0; i < 10; i++) {
                const fecha = new Date();
                fecha.setDate(hoy.getDate() + i);
                const fechaStr = formatDate(fecha);

                if (Math.random() > 0.5) {
                    window.bookedSlots[fechaStr] = [];
                    const horarios = ['09:00', '10:30', '14:00', '16:30'];
                    const cantidad = Math.floor(Math.random() * 3) + 1;

                    for (let j = 0; j < cantidad; j++) {
                        const horario = horarios[Math.floor(Math.random() * horarios.length)];
                        if (!window.bookedSlots[fechaStr].includes(horario)) {
                            window.bookedSlots[fechaStr].push(horario);
                        }
                    }
                }
            }
        }

        // ========== FUNCI√ìN setupEventListeners ==========
        function setupEventListeners() {
            console.log("üõ†Ô∏è Configurando eventos...");

            // Asegurar que el modal est√© OCULTO al inicio
            const modal = document.getElementById('newConfirmationModal');
            if (modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
                console.log("‚úÖ Modal oculto al inicio");
            }

            // Al inicio de setupEventListeners
            console.log("üîç Variables globales al iniciar:", {
                selectedDate: window.selectedDate,
                selectedTime: window.selectedTime,
                selectedService: window.selectedService
            });

            // Navegaci√≥n entre p√°ginas
            const btnMainPage = document.getElementById('btnMainPage');
            const btnReservationPage = document.getElementById('btnReservationPage');
            const mainPage = document.getElementById('mainPage');
            const reservationPage = document.getElementById('reservationPage');

            if (btnMainPage && btnReservationPage && mainPage && reservationPage) {
                btnMainPage.addEventListener('click', function () {
                    mainPage.classList.add('active');
                    reservationPage.classList.remove('active');
                    btnMainPage.classList.add('active');
                    btnReservationPage.classList.remove('active');
                });

                btnReservationPage.addEventListener('click', function () {
                    reservationPage.classList.add('active');
                    mainPage.classList.remove('active');
                    btnReservationPage.classList.add('active');
                    btnMainPage.classList.remove('active');
                });
            }

            // Bot√≥n para ir a reservas desde la p√°gina principal
            const goToReservationBtn = document.getElementById('goToReservationBtn');
            if (goToReservationBtn) {
                goToReservationBtn.addEventListener('click', function () {
                    if (reservationPage && btnReservationPage) {
                        reservationPage.classList.add('active');
                        if (mainPage) mainPage.classList.remove('active');
                        btnReservationPage.classList.add('active');
                        if (btnMainPage) btnMainPage.classList.remove('active');
                    }
                });
            }

            // Bot√≥n para ir al calendario
            const goToCalendarBtn = document.getElementById('goToCalendarBtn');
            if (goToCalendarBtn) {
                goToCalendarBtn.addEventListener('click', function () {
                    if (reservationPage && btnReservationPage) {
                        reservationPage.classList.add('active');
                        if (mainPage) mainPage.classList.remove('active');
                        btnReservationPage.classList.add('active');
                        if (btnMainPage) btnMainPage.classList.remove('active');
                    }
                });
            }

            // Navegaci√≥n del calendario
            const prevMonthBtn = document.getElementById('prevMonth');
            const nextMonthBtn = document.getElementById('nextMonth');

            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', function () {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar(currentMonth, currentYear);
                });
            }

            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', function () {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar(currentMonth, currentYear);
                });
            }

            // Selector de servicio
            // Dentro de setupEventListeners, busca esto y corr√≠gelo:
            const serviceSelect = document.getElementById('serviceSelect');
            if (serviceSelect) {
                serviceSelect.addEventListener('change', function () {
                    // Actualizar variable global
                    window.selectedService = this.value;
                    selectedService = this.value;
                    console.log("‚úÇÔ∏è Servicio seleccionado:", this.value);
                    updateReservationSummary();
                });

            }

            // Modal de confirmaci√≥n
            const copyMessageBtn = document.getElementById('copyMessageBtn');
            if (copyMessageBtn) {
                copyMessageBtn.addEventListener('click', copyMessageToClipboard);
            }

            const closeModalBtn = document.getElementById('closeModalBtn');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeModal);
            }

            // Reportar problemas
            const toggleReportBtn = document.getElementById('toggleReport');
            const reportForm = document.getElementById('reportForm');

            if (toggleReportBtn && reportForm) {
                toggleReportBtn.addEventListener('click', function () {
                    reportForm.classList.toggle('active');
                });
            }

            const sendReportBtn = document.getElementById('sendReport');
            if (sendReportBtn) {
                sendReportBtn.addEventListener('click', sendReport);
            }

            const botonConfirmar = document.getElementById('confirmReservationBtn');
            if (botonConfirmar) {
                // Eliminar todos los listeners anteriores
                const nuevoBoton = botonConfirmar.cloneNode(true);
                botonConfirmar.parentNode.replaceChild(nuevoBoton, botonConfirmar);

                // Agregar listener al nuevo bot√≥n
                const botonFresco = document.getElementById('confirmReservationBtn');
                botonFresco.addEventListener('click', function (event) {
                    if (event) {
                        event.preventDefault();
                        event.stopPropagation();
                    }

                    // Verificar si existe la funci√≥n
                    if (typeof window.confirmReservation === 'function') {
                        window.confirmReservation();
                    } else {
                        alert("Por favor, recarga la p√°gina.");
                    }

                    return false;
                });
            }

            // ‚≠ê‚≠ê‚≠ê SOLAMENTE ESTA SECCI√ìN PARA EL BOT√ìN DE CONFIRMAR ‚≠ê‚≠ê‚≠ê
            const confirmBtn = document.getElementById('confirmReservationBtn');
            if (confirmBtn) {
                // Remover cualquier listener existente
                confirmBtn.replaceWith(confirmBtn.cloneNode(true));

                // Obtener el nuevo bot√≥n
                const freshConfirmBtn = document.getElementById('confirmReservationBtn');

                // Agregar UN solo listener
                freshConfirmBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation(); // ‚¨ÖÔ∏è Esto es importante

                    console.log("‚úÖ Bot√≥n de confirmaci√≥n clickeado - UNICO LISTENER");

                    // Llamar directamente a la funci√≥n
                    if (window.confirmReservation) {
                        window.confirmReservation();
                    } else {
                        console.error("‚ùå Funci√≥n confirmReservation no encontrada");
                        showNotification("‚ùå Error interno. Recarga la p√°gina.", "error");
                    }
                }, { once: false }); // Asegurar que no sea "once"

                console.log("‚úÖ Bot√≥n de confirmaci√≥n configurado correctamente");
            }


            console.log("‚úÖ Eventos configurados");

            // AL FINAL, configurar eventos del modal
            setupModalEvents();

            console.log("‚úÖ Todos los eventos configurados");

            // Configurar eventos de la nueva ventana de confirmaci√≥n
            function setupModalEvents() {
                console.log("üîß Configurando eventos del modal...");

                // Bot√≥n cerrar
                const closeBtn = document.getElementById('newCloseModalBtn');
                if (closeBtn) {
                    closeBtn.onclick = function () {
                        const modal = document.getElementById('newConfirmationModal');
                        if (modal) {
                            modal.classList.remove('active');
                            resetForm();
                        }
                    };
                }

                // Cerrar al hacer clic fuera del modal
                const modal = document.getElementById('newConfirmationModal');
                if (modal) {
                    modal.addEventListener('click', function (e) {
                        if (e.target === this) {
                            this.classList.remove('active');
                            resetForm();
                        }
                    });
                }

                // Cerrar con tecla ESC
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        const modal = document.getElementById('newConfirmationModal');
                        if (modal && modal.classList.contains('active')) {
                            modal.classList.remove('active');
                            resetForm();
                        }
                    }
                });

                // Dentro de setupEventListeners(), despu√©s de los otros listeners:
                const whatsappInput = document.getElementById('clientWhatsApp');
                if (whatsappInput) {
                    whatsappInput.addEventListener('input', function (e) {
                        // Eliminar caracteres no num√©ricos
                        let value = this.value.replace(/\D/g, '');

                        // Limitar a 10 d√≠gitos
                        if (value.length > 10) {
                            value = value.substring(0, 10);
                        }

                        this.value = value;

                        // Cambiar estilo seg√∫n validaci√≥n
                        if (value.length === 10) {
                            this.style.borderColor = 'var(--success)';
                            this.style.boxShadow = '0 0 0 2px rgba(76, 175, 80, 0.2)';
                        } else {
                            this.style.borderColor = value.length > 0 ? 'var(--error)' : 'var(--gray-light)';
                            this.style.boxShadow = 'none';
                        }
                    });

                    // Tambi√©n agregar validaci√≥n al perder el foco
                    whatsappInput.addEventListener('blur', function () {
                        const value = this.value.replace(/\D/g, '');
                        if (value.length > 0 && value.length !== 10) {
                            showNotification("‚ö†Ô∏è El WhatsApp debe tener 10 d√≠gitos", "error");
                        }
                    });
                }
            }
        }


        // Renderizar calendario - FUNCI√ìN COMPLETA Y CORREGIDA
        function renderCalendar(month, year) {
            console.log(`üìÖ Renderizando calendario: ${month + 1}/${year}`);

            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

            // Actualizar encabezado del mes
            const monthHeader = document.getElementById('currentMonth');
            if (monthHeader) {
                monthHeader.textContent = `${monthNames[month]} ${year}`;
            }

            // Calcular d√≠as del mes
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = firstDay.getDay(); // 0 = Domingo
            const daysInMonth = lastDay.getDate();

            // Obtener contenedor de fechas
            const calendarDates = document.getElementById('calendarDates');
            if (!calendarDates) {
                console.error('‚ùå No se encontr√≥ calendarDates');
                return;
            }

            // Limpiar calendario
            calendarDates.innerHTML = '';

            // A√±adir d√≠as vac√≠os al inicio
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('calendar-date', 'disabled');
                emptyDay.textContent = '';
                calendarDates.appendChild(emptyDay);
            }

            // Hoy para comparar
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Crear d√≠as del mes
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDate(date);
                const dateElement = document.createElement('div');
                dateElement.classList.add('calendar-date');
                dateElement.textContent = day;
                dateElement.dataset.date = dateStr;
                dateElement.title = dateStr;

                // Deshabilitar fechas pasadas
                if (date < today) {
                    dateElement.classList.add('disabled');
                    dateElement.title = 'Fecha pasada';
                } else {
                    // Verificar si est√° seleccionada
                    if (window.selectedDate === dateStr) {
                        dateElement.classList.add('selected');
                    }

                    // Verificar si tiene slots bloqueados
                    const isFullyBooked = checkIfDateFullyBooked(dateStr);
                    if (isFullyBooked) {
                        dateElement.classList.add('disabled');
                        dateElement.title = 'Sin horarios disponibles';
                    } else {
                        dateElement.addEventListener('click', function () {
                            selectDate(dateStr);
                        });
                    }
                }
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0); // Solo fecha, sin hora

                // Crear d√≠as del mes
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dateStr = formatDate(date);
                    const dateElement = document.createElement('div');
                    dateElement.classList.add('calendar-date');
                    dateElement.textContent = day;
                    dateElement.dataset.date = dateStr;
                    dateElement.title = dateStr;

                    // Deshabilitar fechas pasadas (ayer o anteriores)
                    if (date < hoy) {
                        dateElement.classList.add('disabled');
                        dateElement.title = 'Fecha pasada';
                        dateElement.style.opacity = '0.5';
                    }
                    // Deshabilitar hoy si ya pasaron las horas de atenci√≥n
                    else if (date.getDate() === hoy.getDate() &&
                        date.getMonth() === hoy.getMonth() &&
                        date.getFullYear() === hoy.getFullYear()) {

                        const ahora = new Date();
                        const horaActual = ahora.getHours();

                        // Si ya pas√≥ la hora de cierre (18:00), deshabilitar hoy
                        if (horaActual >= 18) {
                            dateElement.classList.add('disabled');
                            dateElement.title = 'Ya cerramos por hoy';
                            dateElement.style.opacity = '0.5';
                        } else {
                            // Hoy est√° disponible, pero solo horarios futuros
                            dateElement.title = 'Hoy - Solo horarios futuros';

                            if (selectedDate === dateStr) {
                                dateElement.classList.add('selected');
                            }

                            dateElement.addEventListener('click', function () {
                                selectDate(dateStr);
                            });
                        }
                    }
                    else {
                        // Fecha futura (ma√±ana o despu√©s)
                        if (selectedDate === dateStr) {
                            dateElement.classList.add('selected');
                        }

                        // Verificar si tiene slots bloqueados
                        const isFullyBooked = checkIfDateFullyBooked(dateStr);
                        if (isFullyBooked) {
                            dateElement.classList.add('disabled');
                            dateElement.title = 'Sin horarios disponibles';
                        } else {
                            dateElement.addEventListener('click', function () {
                                selectDate(dateStr);
                            });
                        }
                    }

                    calendarDates.appendChild(dateElement);
                }


                calendarDates.appendChild(dateElement);
            }

            console.log(`‚úÖ Calendario renderizado: ${daysInMonth} d√≠as`);
        }

        function parseDate(dateStr) {
            if (!dateStr) return new Date();

            try {
                const [year, month, day] = dateStr.split('-').map(Number);
                return new Date(year, month - 1, day);
            } catch (error) {
                console.error('Error parseando fecha:', dateStr, error);
                return new Date(); // Retorna fecha actual por defecto
            }
        }

        function esFechaHoraPasada(fechaStr, horaStr) {
            try {
                const hoy = new Date();

                // Parsear la fecha seleccionada
                const [year, month, day] = fechaStr.split('-').map(Number);
                const [hour, minute] = horaStr.split(':').map(Number);

                // Crear objeto Date con la fecha y hora seleccionadas
                const fechaSeleccionada = new Date(year, month - 1, day, hour, minute);

                // Comparar con la fecha/hora actual
                return fechaSeleccionada < hoy;

            } catch (error) {
                console.error('Error verificando fecha:', error);
                return true; // Por seguridad, si hay error, no permitir
            }
        }


        // Funci√≥n para formatear fecha como YYYY-MM-DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Funci√≥n para parsear fecha de string
        function parseDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            return new Date(year, month - 1, day);
        }

        // Funci√≥n para formatear fecha para mostrar
        function formatDateForDisplay(date) {
            return date.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Inicializar calendario - LLAMAR AL CARGAR
        function initCalendar() {
            const now = new Date();
            window.currentMonth = now.getMonth();
            window.currentYear = now.getFullYear();
            renderCalendar(window.currentMonth, window.currentYear);
        }

        // Cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM cargado');
            initCalendar();
            setupEventListeners();
        });


        // Agrega esta funci√≥n y ejec√∫tala en setupEventListeners
        function debugConfirmButton() {
            const confirmBtn = document.getElementById('confirmReservationBtn');

            if (!confirmBtn) {
                console.error('‚ùå Bot√≥n confirmReservationBtn no encontrado en el DOM');
                return;
            }

            console.log('üîç Bot√≥n confirmReservationBtn encontrado');

            // Remover listeners anteriores (por si acaso)
            confirmBtn.removeEventListener('click', confirmReservation);

            // Agregar nuevo listener con logging
            confirmBtn.addEventListener('click', function (event) {
                console.log('üñ±Ô∏è Bot√≥n de confirmaci√≥n clickeado');
                console.log('üìç Evento:', event);
                console.log('üìç Bot√≥n:', this);

                // Verificar si hay un formulario
                const form = this.closest('form') || this.closest('.reservation-form');
                if (form) {
                    console.log('üìã Formulario encontrado:', form);
                }

                confirmReservation();
            });

            // Tambi√©n agregar listener para tecla Enter en los inputs
            const inputs = ['clientName', 'clientWhatsApp'];
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('keypress', function (event) {
                        if (event.key === 'Enter') {
                            console.log('‚Üµ Enter presionado en', inputId);
                            event.preventDefault();
                            confirmReservation();
                        }
                    });
                }
            });
        }

        function loadDefaultServices() {
            console.log('üì¶ Cargando servicios por defecto');

            servicePrices = {
                'Corte de Cabello': 2500,
                'Corte + Barba': 3200,
                'Arreglo de Barba': 1800,
                'Afeitado Cl√°sico': 2200
            };
        }

        // Cargar agenda - VERSI√ìN MEJORADA


        // Datos de demostraci√≥n
        function loadDemoData() {
            console.log('Cargando datos demo');
            const exampleBookedSlots = {};
            const hoy = new Date();

            for (let i = 0; i < 10; i++) {
                const fecha = new Date();
                fecha.setDate(hoy.getDate() + i);
                const fechaStr = formatDate(fecha);

                if (Math.random() > 0.5) {
                    exampleBookedSlots[fechaStr] = [];
                    const horarios = ['09:00', '10:30', '14:00', '16:30'];
                    const cantidad = Math.floor(Math.random() * 3) + 1;

                    for (let j = 0; j < cantidad; j++) {
                        const horario = horarios[Math.floor(Math.random() * horarios.length)];
                        if (!exampleBookedSlots[fechaStr].includes(horario)) {
                            exampleBookedSlots[fechaStr].push(horario);
                        }
                    }
                }
            }

            window.bookedSlots = exampleBookedSlots;
        }

        // Inicializar calendario
        function initCalendar() {
            const now = new Date();
            currentMonth = now.getMonth();
            currentYear = now.getFullYear();
            renderCalendar(currentMonth, currentYear);
        }

        // Renderizar calendario
        function renderCalendar(month, year) {
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1);
            const startingDay = firstDay.getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            const calendarDates = document.getElementById('calendarDates');
            if (!calendarDates) return;
            calendarDates.innerHTML = '';

            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('calendar-date', 'disabled');
                calendarDates.appendChild(emptyDay);
            }

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDate(date);
                const dateElement = document.createElement('div');
                dateElement.classList.add('calendar-date');
                dateElement.textContent = day;
                dateElement.dataset.date = dateStr;

                if (date < today) {
                    dateElement.classList.add('disabled');
                } else {
                    if (selectedDate === dateStr) {
                        dateElement.classList.add('selected');
                    }

                    dateElement.addEventListener('click', function () {
                        selectDate(dateStr);
                    });
                }

                calendarDates.appendChild(dateElement);
            }
        }

        // ========== INICIALIZACI√ìN ==========
        document.addEventListener('DOMContentLoaded', function () {
            console.log('üì± DOM cargado - Iniciando aplicaci√≥n...');

            // Inicializar TODO con retraso peque√±o para asegurar DOM completo
            setTimeout(() => {
                initializeApp();
            }, 100);

            // Evitar m√∫ltiples ejecuciones
            let initialized = false;
            const originalOnLoad = window.onload;
            window.onload = function () {
                if (!initialized) {
                    if (typeof originalOnLoad === 'function') originalOnLoad();
                    initialized = true;
                }
            };
        });

        // Mostrar p√°gina
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            const pageElement = document.getElementById(pageId);
            if (pageElement) {
                pageElement.classList.add('active');
            }

            if (pageId === 'reservationPage') {
                updateAvailableHours();
                updateReservationSummary();
            }
        }

        // Seleccionar fecha
        function selectDate(dateStr) {
            // Asegurar que estamos usando la variable global
            window.selectedDate = dateStr;
            selectedDate = dateStr; // Tambi√©n la local por si acaso

            // Remover selecci√≥n anterior
            document.querySelectorAll('.calendar-date').forEach(el => {
                el.classList.remove('selected');
                if (el.dataset.date === dateStr) {
                    el.classList.add('selected');
                }
            });

            // Actualizar texto
            const dateObj = parseDate(dateStr);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const selectedDateText = document.getElementById('selectedDateText');
            if (selectedDateText) {
                selectedDateText.textContent = `Turnos disponibles para el ${dateObj.toLocaleDateString('es-ES', options)}`;
            }

            updateAvailableHours();
            updateReservationSummary();
            debugTurnosReservados();


            // Scroll al formulario si ya hay hora seleccionada
            if (selectedTime) {
                scrollToReservationForm();
            }

            console.log("üìÖ Fecha seleccionada:", dateStr);
        }

        // Seleccionar hora
        function selectTime(timeStr) {
            // Asegurar variable global
            window.selectedTime = timeStr;
            selectedTime = timeStr;

            // Validar si la fecha/hora ya pas√≥
            if (window.selectedDate && esFechaHoraPasada(window.selectedDate, timeStr)) {
                showNotification('‚ùå No puedes reservar un horario que ya pas√≥', 'error');
                return;
            }

            // Validar que sea hora en punto
            const minutos = timeStr.split(':')[1];
            if (minutos !== '00') {
                showNotification('‚ö†Ô∏è Las reservas son solo en horas en punto (ej: 11:00, 14:00)', 'info');
                return;
            }

            window.selectedTime = timeStr;

            // Actualizar UI
            document.querySelectorAll('.hour-option').forEach(el => {
                el.classList.remove('selected');
                if (el.dataset.time === timeStr) {
                    el.classList.add('selected');
                }
            });

            updateReservationSummary();

            // Scroll al formulario si ya hay fecha seleccionada
            if (selectedDate) {
                scrollToReservationForm();
            }

            console.log("‚è∞ Hora seleccionada:", timeStr);
        }

        // Scroll al formulario
        function scrollToReservationForm() {
            setTimeout(() => {
                const reservationSection = document.getElementById('reservation');
                if (reservationSection) {
                    reservationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 300);
        }

        // üî¥ DECLARAR PRIMERO la constante
        const horasValidasBarberia = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
        const startHour = 0;  // Admin configura desde 2:00
        const endHour = 23;   // Admin configura hasta 23:00

     async function updateAvailableHours() {
    const hoursList = document.getElementById('hoursList');
    if (!hoursList) return;

    hoursList.innerHTML = '';

    if (!window.selectedDate) {
        hoursList.innerHTML = '<p style="color: #aaa; text-align: center; padding: 20px;">Selecciona una fecha</p>';
        return;
    }

    let configDia; // <-- DECLARAR configDia aqu√≠, no dentro del try-catch

    try {
        console.log('üìÖ Buscando configuraci√≥n para:', window.selectedDate);
        
        // Intentar obtener configuraci√≥n desde calendario_usuario
        let configDoc;
        try {
            configDoc = await db.collection('calendario_usuario').doc(window.selectedDate).get(); // <-- Declarar configDoc aqu√≠
            if (configDoc.exists) {
                configDia = configDoc.data();
            }
        } catch (error) {
            console.log('Usando configuraci√≥n local');
        }
        
        // Si no se encontr√≥ en calendario_usuario, usar configuraci√≥n por defecto
        if (!configDia) {
            // Si no hay configuraci√≥n, usar horario por defecto
            configDia = {
                activo: true,
                hora_inicio: '09:00',
                hora_fin: '19:00',
                descansos: ['12:00', '13:00'],
                duracion_cita: 60
            };
            console.log('‚ö†Ô∏è Usando configuraci√≥n por defecto');
        } else {
            console.log('‚úÖ Configuraci√≥n encontrada:', configDia);
        }
    } catch (error) {
        console.error('‚ùå Error al cargar configuraci√≥n:', error);
        // Configuraci√≥n por defecto si hay error
        configDia = {
            activo: true,
            hora_inicio: '09:00',
            hora_fin: '19:00',
            descansos: ['12:00', '13:00'],
            duracion_cita: 60
        };
    }
    
    const bookedForDate = window.bookedSlots ? (window.bookedSlots[window.selectedDate] || []) : [];
    const blockedForDate = window.blockedHours ? (window.blockedHours[window.selectedDate] || []) : [];
    
    const isDayBlocked = window.blockedHours ? (window.blockedHours[window.selectedDate] === 'all') : false;
    
    // Verificar si el d√≠a est√° deshabilitado en la agenda
    if (configDia.activo === false || isDayBlocked) {
        hoursList.innerHTML = `
            <div style="text-align: center; padding: 20px;">
                <i class="fas fa-ban" style="color: #ff4444; font-size: 2rem; margin-bottom: 10px;"></i>
                <p style="color: #ff4444; font-weight: bold;">D√≠a no laborable</p>
                ${configDia.activo === false ? '<p style="color: #aaa; font-size: 0.9rem;">D√≠a deshabilitado en la agenda</p>' : ''}
            </div>
        `;
        return;
    }
    
    // OBTENER HORAS DESDE CONFIGURACI√ìN
    let horaInicio = configDia.hora_inicio || '09:00';
    let horaFin = configDia.hora_fin || '19:00';
    const descansos = configDia.descansos || [];
    
    console.log('‚è∞ Horarios configurados:', { horaInicio, horaFin, descansos });
    
    // Convertir horas a n√∫meros
    const [startHour, startMinute] = horaInicio.split(':').map(Number);
    const [endHour, endMinute] = horaFin.split(':').map(Number);
    
    // Verificar si la fecha seleccionada es hoy
    const hoy = new Date();
    const [year, month, day] = window.selectedDate.split('-').map(Number);
    const fechaSeleccionada = new Date(year, month - 1, day);
    const esHoy = hoy.getDate() === fechaSeleccionada.getDate() && 
                  hoy.getMonth() === fechaSeleccionada.getMonth() && 
                  hoy.getFullYear() === fechaSeleccionada.getFullYear();

    let hasAvailableHours = false;
    
    // SOLO HORAS ENTERAS (09:00, 10:00, 11:00, etc.)
    for (let hour = startHour; hour <= endHour; hour++) {
        // Solo mostrar horas v√°lidas (ej: si fin es 19:00, mostrar hasta 18:00)
        if (hour === endHour && endMinute === 0) continue;
        
        const timeStr = `${hour.toString().padStart(2, '0')}:00`;
        
        const isBooked = bookedForDate.includes(timeStr);
        const isBlocked = blockedForDate.includes(timeStr);
        
        // Verificar si es horario de descanso desde la agenda
        const esDescansoAgenda = descansos.some(descanso => {
            // Los descansos pueden estar como "12:00" o "12:00-13:00"
            if (descanso.includes('-')) {
                const [inicioDescanso, finDescanso] = descanso.split('-');
                const horaNum = parseInt(timeStr.split(':')[0]);
                const inicioNum = parseInt(inicioDescanso.split(':')[0]);
                const finNum = parseInt(finDescanso.split(':')[0]);
                return horaNum >= inicioNum && horaNum < finNum;
            } else {
                return descanso === timeStr;
            }
        });
        
        // Verificar si es horario pasado (solo hoy)
        let esHorarioPasado = false;
        if (esHoy) {
            const ahora = new Date();
            const horaSeleccionada = new Date();
            horaSeleccionada.setHours(hour, 0, 0, 0);
            esHorarioPasado = horaSeleccionada < ahora;
        }

        const timeElement = document.createElement('div');
        timeElement.classList.add('hour-option');
        timeElement.dataset.time = timeStr;
        timeElement.textContent = timeStr;

        if (esDescansoAgenda) {
            timeElement.classList.add('disabled');
            timeElement.title = 'Horario de descanso (configurado en agenda)';
            timeElement.style.opacity = '0.4';
            timeElement.style.backgroundColor = '#444';
            timeElement.innerHTML = `<s>${timeStr}</s>`;
            timeElement.innerHTML += '<br><small style="color: #ff9900;">Descanso</small>';
        } 
        else if (isBlocked) {
            timeElement.classList.add('disabled');
            timeElement.title = 'Horario bloqueado por administrador';
            timeElement.style.opacity = '0.4';
            timeElement.style.backgroundColor = '#444';
            timeElement.innerHTML = `<s>${timeStr}</s>`;
            timeElement.innerHTML += '<br><small style="color: #ff4444;">Bloqueado</small>';
        } 
        else if (isBooked) {
            timeElement.classList.add('disabled');
            timeElement.title = 'Horario reservado';
            timeElement.style.opacity = '0.6';
            timeElement.style.backgroundColor = '#333';
            timeElement.innerHTML = `<s>${timeStr}</s>`;
            timeElement.innerHTML += '<br><small style="color: #ff9999;">Reservado</small>';
        } 
        else if (esHorarioPasado) {
            timeElement.classList.add('disabled');
            timeElement.title = 'Horario ya pas√≥';
            timeElement.style.opacity = '0.5';
            timeElement.style.backgroundColor = '#222';
            timeElement.innerHTML = `<s>${timeStr}</s>`;
            timeElement.innerHTML += '<br><small style="color: #aaa;">Pasado</small>';
        } 
        else {
            hasAvailableHours = true;
            timeElement.addEventListener('click', function () {
                selectTime(timeStr);
            });
            timeElement.style.cursor = 'pointer';
            timeElement.style.border = '2px solid var(--primary)';
            timeElement.style.backgroundColor = 'rgba(212, 175, 55, 0.1)';
            timeElement.innerHTML += '<br><small style="color: #d4af37;">Disponible</small>';
        }

        hoursList.appendChild(timeElement);
    }

    if (!hasAvailableHours && !isDayBlocked) {
        hoursList.innerHTML = `
            <div style="text-align: center; padding: 20px;">
                <i class="fas fa-calendar-times" style="color: #d4af37; font-size: 2rem;"></i>
                <p style="color: #d4af37; font-weight: bold;">No hay horarios disponibles</p>
                <p style="color: #aaa; font-size: 0.9rem;">
                    ${esHoy ? 'Los horarios de hoy ya pasaron' : 'Todos los horarios est√°n ocupados o bloqueados'}
                </p>
            </div>
        `;
    }
}

        // Actualizar resumen
        function updateReservationSummary() {
            const summaryDate = document.getElementById('summaryDate');
            const summaryTime = document.getElementById('summaryTime');
            const summaryService = document.getElementById('summaryService');
            const summaryPrice = document.getElementById('summaryPrice');

            if (summaryDate) {
                summaryDate.textContent = window.selectedDate
                    ? formatDateForDisplay(parseDate(window.selectedDate))
                    : 'No seleccionada';
            }

            if (summaryTime) {
                summaryTime.textContent = window.selectedTime || 'No seleccionada';
            }

            if (summaryService) {
                summaryService.textContent = window.selectedService || 'No seleccionado';
            }

            let price = 0;
            if (window.selectedService && servicePrices[window.selectedService]) {
                price = servicePrices[window.selectedService];
            }

            if (summaryPrice) {
                summaryPrice.textContent = `$${price.toLocaleString('es-AR')}`;
            }

            console.log("üìä Resumen actualizado:", {
                fecha: window.selectedDate,
                hora: window.selectedTime,
                servicio: window.selectedService,
                precio: price
            });
        }

        async function notificarActualizacionAgenda() {
            try {
                // Crear un marcador en configuracion para que user.html sepa que debe recargar
                await db.collection('configuracion').doc('ultima_sincronizacion').set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    mensaje: 'Agenda actualizada',
                    version: Date.now()
                });
                console.log('‚úÖ Notificaci√≥n de actualizaci√≥n enviada');
            } catch (error) {
                console.error('Error al notificar:', error);
                // No mostrar error al usuario, es solo una notificaci√≥n
            }
        }

        // Nueva funci√≥n para cargar configuraci√≥n de agenda
        async function cargarConfiguracionAgenda(fecha) {
            try {
                console.log('üîç Buscando configuraci√≥n para:', fecha);

                // 1. Primero intentar desde calendario_usuario
                const configDoc = await db.collection('calendario_usuario').doc(fecha).get();

                if (configDoc.exists) {
                    const configDia = configDoc.data(); // ‚¨ÖÔ∏è Bien aqu√≠
                    console.log('‚úÖ Configuraci√≥n encontrada en calendario_usuario');
                    return configDia;
                }

                // 2. Si no existe, configuraci√≥n por defecto
                const configPorDefecto = {
                    activo: true,
                    hora_inicio: '09:00',
                    hora_fin: '20:00', // ‚¨ÖÔ∏è Ya corregido
                    descansos: diaSemana === 0 || diaSemana === 6 ? [] : ['12:00', '13:00'],
                    duracion_cita: 60
                };

                console.log('‚ö†Ô∏è Usando configuraci√≥n por defecto');
                return configPorDefecto;

            } catch (error) {
                console.error('‚ùå Error al cargar configuraci√≥n:', error);
                return {
                    activo: false,
                    hora_inicio: '09:00',
                    hora_fin: '20:00', // ‚¨ÖÔ∏è Ya corregido
                    descansos: [],
                    duracion_cita: 60
                };
            }
        }

        // Funci√≥n para validar n√∫mero de WhatsApp (10 d√≠gitos)
        function validarWhatsApp(numero) {
            if (!numero || typeof numero !== 'string') {
                console.log("‚ùå WhatsApp no v√°lido: entrada vac√≠a o incorrecta");
                return false;
            }

            // Eliminar espacios, guiones, par√©ntesis, etc.
            const numeroLimpio = numero.replace(/\D/g, '');

            console.log("üì± Validando WhatsApp:", numero, "->", numeroLimpio);

            // Verificar si tiene exactamente 10 d√≠gitos
            if (numeroLimpio.length !== 10) {
                console.log("‚ùå WhatsApp no v√°lido: debe tener 10 d√≠gitos, tiene", numeroLimpio.length);
                return false;
            }

            // Verificar que sean solo n√∫meros
            if (!/^\d+$/.test(numeroLimpio)) {
                console.log("‚ùå WhatsApp no v√°lido: contiene caracteres no num√©ricos");
                return false;
            }

            console.log("‚úÖ WhatsApp v√°lido:", numeroLimpio);
            return numeroLimpio;
        }

        // Funci√≥n principal de confirmaci√≥n de reserva - VERSI√ìN CORREGIDA
        async function confirmReservation() {
            console.log("üõë confirmReservation INICIANDO - √öNICA EJECUCI√ìN");

            // üî¥ BLOQUEAR M√öLTIPLES EJECUCIONES (versi√≥n mejorada)
            if (window.reservaEnProgreso === true) {
                console.log("‚è∏Ô∏è Ya hay una reserva en progreso, ignorando clic");
                showNotification("‚è≥ Por favor espera... procesando reserva anterior", "info");
                return;
            }

            window.reservaEnProgreso = true;
            console.log("üîí Bloqueo activado para evitar m√∫ltiples clics");

            // Obtener valores
            const nombre = document.getElementById('clientName')?.value.trim() || "";
            const whatsappInput = document.getElementById('clientWhatsApp')?.value.trim() || "";
            const servicio = window.selectedService;
            const fecha = window.selectedDate;
            const hora = window.selectedTime;

            console.log('üìù Datos para reserva:', {
                nombre: nombre.substring(0, 3) + '...', // Por privacidad
                whatsapp: whatsappInput.substring(0, 3) + '...',
                servicio,
                fecha,
                hora
            });

            // üî¥ VALIDACI√ìN DE WHATSAPP (10 d√≠gitos) - CORREGIDO EL NOMBRE
            const whatsappValidado = validarWhatsApp(whatsappInput); // ‚¨ÖÔ∏è CORRECCI√ìN AQU√ç
            if (!whatsappValidado) {
                showNotification("‚ùå WhatsApp debe tener 10 d√≠gitos num√©ricos (ej: 1120502186)", "error");
                window.reservaEnProgreso = false; // Liberar bloqueo
                return;
            }

            // Resto de validaciones...
            if (!nombre || !servicio || !fecha || !hora) {
                const faltantes = [];
                if (!nombre) faltantes.push("Nombre");
                if (!servicio) faltantes.push("Servicio");
                if (!fecha) faltantes.push("Fecha");
                if (!hora) faltantes.push("Hora");

                showNotification("‚ùå FALTAN DATOS: " + faltantes.join(", "), "error");
                window.reservaEnProgreso = false; // Liberar bloqueo
                return;
            }

            // Obtener precio
            const precio = window.servicePrices[servicio];
            if (!precio) {
                showNotification("‚ùå Error: servicio no v√°lido", "error");
                window.reservaEnProgreso = false; // Liberar bloqueo
                return;
            }

            // Cambiar estado del bot√≥n
            const confirmBtn = document.getElementById('confirmReservationBtn');
            const originalBtnText = confirmBtn?.innerHTML || '';

            if (confirmBtn) {
                confirmBtn.disabled = true;
                confirmBtn.innerHTML = '<span class="loading"></span> Procesando...';
            }

            try {
                // Usar el n√∫mero validado
                const whatsapp = whatsappValidado;

                // Formatear fecha para mostrar
                let fechaBonita = fecha;
                try {
                    const [year, month, day] = fecha.split('-');
                    const dateObj = new Date(year, month - 1, day);
                    fechaBonita = dateObj.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                } catch (e) {
                    console.error("Error formateando fecha:", e);
                    fechaBonita = fecha;
                }

                // ACTUALIZAR CONTENIDO DEL MODAL
                console.log("üéØ Actualizando contenido del modal...");

                // Actualizar cada campo del modal
                const actualizarCampo = (id, valor) => {
                    const elemento = document.getElementById(id);
                    if (elemento) {
                        elemento.textContent = valor;
                        return true;
                    }
                    return false;
                };

                actualizarCampo('newModalClientName', nombre);
                actualizarCampo('newModalWhatsApp', whatsapp);
                actualizarCampo('newModalDate', fechaBonita);
                actualizarCampo('newModalTime', hora);
                actualizarCampo('newModalService', servicio);
                actualizarCampo('newModalPrice', `$${precio.toLocaleString('es-AR')}`);

                // Configurar bot√≥n de WhatsApp
                const mensajeWhatsapp = `Hola Alexis, soy ${nombre}. Quiero confirmar mi reserva en A.S. Studio:%0A%0AüìÖ Fecha: ${fechaBonita}%0A‚è∞ Hora: ${hora}%0A‚úÇÔ∏è Servicio: ${servicio}%0Aüí∞ Total: $${precio.toLocaleString('es-AR')}%0A%0AMi WhatsApp: ${whatsapp}%0A%0A¬øEst√° disponible este horario?`;

                const whatsappBtn = document.getElementById('newWhatsappConfirmBtn');
                if (whatsappBtn) {
                    // Remover eventos anteriores
                    const nuevoBtn = whatsappBtn.cloneNode(true);
                    whatsappBtn.parentNode.replaceChild(nuevoBtn, whatsappBtn);
                    const newWhatsappBtn = document.getElementById('newWhatsappConfirmBtn');

                    newWhatsappBtn.onclick = function () {
                        window.open(`https://wa.me/54911155739203?text=${mensajeWhatsapp}`, '_blank');
                        setTimeout(() => {
                            closeNewModal();
                        }, 1000);
                    };
                }

                // Configurar bot√≥n de cerrar
                const closeBtn = document.getElementById('newCloseModalBtn');
                if (closeBtn) {
                    closeBtn.onclick = closeNewModal;
                }

                // MOSTRAR EL MODAL
                const newModal = document.getElementById('newConfirmationModal');
                if (newModal) {
                    newModal.style.display = 'flex';
                    setTimeout(() => {
                        newModal.classList.add('active');

                        // Guardar en Firebase (en segundo plano)
                        setTimeout(async () => {
                            try {
                                console.log("üíæ Guardando en Firebase...");
                                const result = await saveReservationToFirebase(nombre, whatsapp);
                                console.log('‚úÖ Resultado Firebase:', result);

                                if (result.success) {
                                    // Actualizar slots localmente SOLO UNA VEZ
                                    if (!window.bookedSlots[fecha]) {
                                        window.bookedSlots[fecha] = [];
                                    }
                                    window.bookedSlots[fecha].push(hora);
                                    updateAvailableHours();
                                    showNotification("‚úÖ Reserva guardada correctamente", "success");
                                } else {
                                    showNotification(`‚ùå ${result.message || 'Error al guardar'}`, 'error');
                                }
                            } catch (error) {
                                console.error('‚ö†Ô∏è Error guardando en Firebase:', error);
                                showNotification("‚ö†Ô∏è Error al guardar la reserva", "error");
                            }
                        }, 500);
                    }, 50);
                }

            } catch (error) {
                console.error('‚ùå Error:', error);
                showNotification('‚ùå Error al procesar la reserva', 'error');
            } finally {
                // Restaurar bot√≥n despu√©s de 3 segundos y liberar
                setTimeout(() => {
                    if (confirmBtn) {
                        confirmBtn.disabled = false;
                        confirmBtn.innerHTML = originalBtnText;
                    }
                    window.reservaEnProgreso = false; // üî¥ IMPORTANTE: Liberar para nuevas reservas
                    console.log("üü¢ Reserva completada, sistema liberado");
                }, 3000);
            }
        }

        // Funci√≥n para cerrar el modal
        function closeNewModal() {
            console.log("üî¥ Cerrando modal...");
            const modal = document.getElementById('newConfirmationModal');
            if (modal) {
                modal.classList.remove('active');

                // Esperar a que termine la animaci√≥n antes de ocultar
                setTimeout(() => {
                    modal.style.display = 'none';
                    resetForm();
                    console.log("‚úÖ Modal cerrado y formulario limpiado");
                }, 300);
            }
        }

        // Funci√≥n para resetear el formulario
        function resetForm() {
            // Limpiar campos del formulario
            document.getElementById('clientName').value = '';
            document.getElementById('clientWhatsApp').value = '';
            document.getElementById('serviceSelect').value = '';

            // Limpiar selecciones
            document.querySelectorAll('.selected').forEach(el => {
                el.classList.remove('selected');
            });

            // Resetear variables globales
            window.selectedDate = null;
            window.selectedTime = null;
            window.selectedService = null;

            // Actualizar UI
            updateReservationSummary();
            updateAvailableHours();

            // Volver al calendario
            const selectedDateText = document.getElementById('selectedDateText');
            if (selectedDateText) {
                selectedDateText.textContent = 'Selecciona una fecha en el calendario';
            }

            console.log("‚úÖ Formulario reseteado");
        }

        // Funci√≥n para mostrar notificaciones
        function showNotification(message, type = "info") {
            const notification = document.getElementById('notification');
            if (!notification) return;

            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.style.display = 'block';

            // Ocultar despu√©s de 5 segundos
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Configurar eventos del modal
        function setupModalEvents() {
            console.log("üîß Configurando eventos del modal...");

            // Bot√≥n cerrar
            const closeBtn = document.getElementById('newCloseModalBtn');
            if (closeBtn) {
                closeBtn.onclick = closeNewModal;
                console.log("‚úÖ Bot√≥n cerrar configurado");
            }

            // Cerrar al hacer clic fuera
            const modal = document.getElementById('newConfirmationModal');
            if (modal) {
                modal.onclick = function (e) {
                    if (e.target === this) {
                        closeNewModal();
                    }
                };
                console.log("‚úÖ Clic fuera configurado");
            }

            // Cerrar con tecla ESC
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('newConfirmationModal');
                    if (modal && modal.classList.contains('active')) {
                        closeNewModal();
                    }
                }
            });
            console.log("‚úÖ Tecla ESC configurada");

            // Funci√≥n para cerrar el modal
            function closeNewModal() {
                console.log("üî¥ Cerrando modal...");
                const modal = document.getElementById('newConfirmationModal');
                if (modal) {
                    modal.classList.remove('active');

                    // Esperar a que termine la animaci√≥n antes de ocultar
                    setTimeout(() => {
                        modal.style.display = 'none';
                        resetForm();
                        console.log("‚úÖ Modal cerrado y formulario limpiado");
                    }, 300);
                }
            }

            // Funci√≥n para resetear el formulario
            function resetForm() {
                // Limpiar campos del formulario
                document.getElementById('clientName').value = '';
                document.getElementById('clientWhatsApp').value = '';
                document.getElementById('serviceSelect').value = '';

                // Limpiar selecciones
                document.querySelectorAll('.selected').forEach(el => {
                    el.classList.remove('selected');
                });

                // Resetear variables globales
                window.selectedDate = null;
                window.selectedTime = null;
                window.selectedService = null;

                // Actualizar UI
                updateReservationSummary();
                updateAvailableHours();

                // Volver al calendario
                const selectedDateText = document.getElementById('selectedDateText');
                if (selectedDateText) {
                    selectedDateText.textContent = 'Selecciona una fecha en el calendario';
                }

                console.log("‚úÖ Formulario reseteado");
            }

            // Funci√≥n para mostrar notificaciones (si no la tienes)
            function showNotification(message, type = "info") {
                const notification = document.getElementById('notification');
                if (!notification) return;

                notification.textContent = message;
                notification.className = 'notification ' + type;
                notification.style.display = 'block';

                // Ocultar despu√©s de 5 segundos
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 5000);
            }

            // FUNCI√ìN NUEVA que muestra el modal INMEDIATAMENTE
            function mostrarModalInmediato(nombre, whatsapp, fecha, hora, servicio, precio) {
                console.log("üéØ Mostrando modal inmediato");

                // Formatear fecha
                let fechaBonita = fecha;
                try {
                    const [year, month, day] = fecha.split('-');
                    const dateObj = new Date(year, month - 1, day);
                    fechaBonita = dateObj.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                } catch (e) {
                    console.error("Error formateando fecha:", e);
                }

                // 1. ACTUALIZAR CONTENIDO DEL MODAL
                const elementos = {
                    'modalClientName': nombre,
                    'modalWhatsApp': whatsapp,
                    'modalDate': fechaBonita,
                    'modalTime': hora,
                    'modalService': servicio,
                    'modalPrice': `$${precio.toLocaleString('es-AR')}`
                };

                for (const [id, valor] of Object.entries(elementos)) {
                    const elemento = document.getElementById(id);
                    if (elemento) {
                        elemento.textContent = valor;
                        console.log(`‚úÖ ${id} actualizado:`, valor);
                    } else {
                        console.error(`‚ùå Elemento ${id} no encontrado`);
                    }
                }

                // 2. CONFIGURAR WHATSAPP
                const mensajeWhatsapp = `Hola Alexis, soy ${nombre}. Quiero confirmar mi reserva en A.S. Studio:%0A%0AüìÖ Fecha: ${fechaBonita}%0A‚è∞ Hora: ${hora}%0A‚úÇÔ∏è Servicio: ${servicio}%0Aüí∞ Total: $${precio.toLocaleString('es-AR')}%0A%0AMi WhatsApp: ${whatsapp}%0A%0A¬øEst√° disponible este horario?`;

                const whatsappLink = document.getElementById('whatsappLink');
                if (whatsappLink) {
                    whatsappLink.href = `https://wa.me/54911155739203?text=${mensajeWhatsapp}`;
                    whatsappLink.dataset.message = mensajeWhatsapp;
                    console.log("‚úÖ WhatsApp configurado");
                }

                // 3. CONFIGURAR BOT√ìN COPIAR
                const copyBtn = document.getElementById('copyMessageBtn');
                if (copyBtn) {
                    copyBtn.onclick = function () {
                        const texto = `Reserva A.S. Studio\nCliente: ${nombre}\nWhatsApp: ${whatsapp}\nFecha: ${fechaBonita}\nHora: ${hora}\nServicio: ${servicio}\nTotal: $${precio.toLocaleString('es-AR')}`;

                        navigator.clipboard.writeText(texto).then(() => {
                            alert('‚úÖ Informaci√≥n copiada al portapapeles');
                        }).catch(() => {
                            // Fallback para navegadores antiguos
                            const textarea = document.createElement('textarea');
                            textarea.value = texto;
                            document.body.appendChild(textarea);
                            textarea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textarea);
                            alert('‚úÖ Informaci√≥n copiada');
                        });
                    };
                }
            }

            // Funci√≥n simple para cerrar el modal
            function closeNewModal() {
                console.log("üî¥ Cerrando modal...");
                const modal = document.getElementById('newConfirmationModal');
                if (modal) {
                    modal.classList.remove('active');
                    console.log("‚úÖ Modal cerrado");

                    // Limpiar formulario
                    resetForm();
                }
            }

            // Configurar eventos del modal - versi√≥n simplificada
            function setupModalEvents() {
                console.log("üîß Configurando eventos del modal...");

                // Bot√≥n cerrar
                const closeBtn = document.getElementById('newCloseModalBtn');
                if (closeBtn) {
                    closeBtn.onclick = closeNewModal;
                    console.log("‚úÖ Bot√≥n cerrar configurado");
                }

                // Cerrar al hacer clic fuera
                const modal = document.getElementById('newConfirmationModal');
                if (modal) {
                    modal.onclick = function (e) {
                        if (e.target === this) {
                            closeNewModal();
                        }
                    };
                    console.log("‚úÖ Clic fuera configurado");
                }

                // Cerrar con tecla ESC
                document.onkeydown = function (e) {
                    if (e.key === 'Escape') {
                        const modal = document.getElementById('newConfirmationModal');
                        if (modal && modal.classList.contains('active')) {
                            closeNewModal();
                        }
                    }
                };
                console.log("‚úÖ Tecla ESC configurada");
            }

            // Asegurar que se llame a setupModalEvents cuando el DOM est√© listo
            document.addEventListener('DOMContentLoaded', function () {
                console.log("üöÄ Inicializando sistema completo...");


                // Inicializar calendario
                initCalendar();

                // Configurar eventos
                setupEventListeners();

                // Configurar eventos del modal
                setupModalEvents();

                console.log("‚úÖ Sistema completamente inicializado");
            });
        }
    </script>
</body>

</html>
